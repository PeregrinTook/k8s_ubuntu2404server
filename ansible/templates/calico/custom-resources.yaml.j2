# templates/calico/custom-resources.yaml.j2
apiVersion: operator.tigera.io/v1
kind: Installation
metadata:
  name: default
spec:
  # Конфигурация Calico
  calicoNetwork:
    # Настройки IP-пулов
    ipPools:
    - blockSize: {{ calico_block_size | default(26) }}
      cidr: {{ calico_pod_cidr | default('10.244.0.0/16') }}
      encapsulation: {{ calico_encapsulation | default('VXLANCrossSubnet') }}
      natOutgoing: {{ calico_nat_outgoing | default('Enabled') }}

  # Настройки для контроля ресурсов
  controlPlaneReplicas: {{ calico_control_plane_replicas | default(2) }}

  # Выбор используемого CNI плагина
  cni:
    type: {{ calico_cni_type | default('Calico') }}

  # Настройки узлов
  nodeUpdateStrategy:
    rollingUpdate:
      maxUnavailable: 1
    type: RollingUpdate